# 首页产品显示设置说明

## 📋 修改内容

已修复首页的产品显示逻辑：

### 1. 新品上线区域
- **显示规则**：显示带有"新品上线"标签的产品
- **数量**：最多显示 5 个产品
- **排序**：按发布日期倒序（最新的在前）
- **标签 slug**：`new-arrival`

### 2. 更多产品区域
- **显示规则**：显示除了"新品上线"标签之外的所有产品
- **数量**：最多显示 10 个产品
- **排序**：按发布日期倒序
- **特殊标记**：
  - 促销产品显示 "SALE" 标签
  - 特色产品显示 "HOT" 标签

### 3. 热门推荐区域
- **显示规则**：按产品分类显示
- **数量**：每个分类最多显示 5 个产品
- **标签**：所有产品显示 "HOT" 标签

## 🎯 如何设置"新品上线"标签

### 方法 1：在 WordPress 后台创建标签

1. **进入标签管理**
   ```
   WordPress 后台 → 产品 → 标签
   ```

2. **添加新标签**
   - 名称：`新品上线`
   - 别名（slug）：`new-arrival`（重要！必须是这个）
   - 描述：新上线的产品
   - 点击"添加新标签"

3. **为产品添加标签**
   ```
   WordPress 后台 → 产品 → 编辑产品
   ```
   - 在右侧找到"产品标签"区域
   - 输入"新品上线"或从列表中选择
   - 点击"更新"保存

### 方法 2：批量添加标签

1. **进入产品列表**
   ```
   WordPress 后台 → 产品
   ```

2. **批量操作**
   - 勾选要设置为新品的产品
   - 在"批量操作"下拉菜单中选择"编辑"
   - 点击"应用"
   - 在"产品标签"中选择"添加"
   - 输入"新品上线"
   - 点击"更新"

### 方法 3：使用 SQL 批量添加（高级）

如果您有很多产品需要设置，可以使用 SQL：

```sql
-- 1. 首先确保标签存在
INSERT INTO wp_terms (name, slug) 
VALUES ('新品上线', 'new-arrival')
ON DUPLICATE KEY UPDATE slug = 'new-arrival';

-- 2. 获取标签的 term_id
SET @tag_id = (SELECT term_id FROM wp_terms WHERE slug = 'new-arrival');

-- 3. 确保 term_taxonomy 记录存在
INSERT INTO wp_term_taxonomy (term_id, taxonomy, description) 
VALUES (@tag_id, 'product_tag', '新上线的产品')
ON DUPLICATE KEY UPDATE taxonomy = 'product_tag';

-- 4. 为最新的 5 个产品添加标签（示例）
INSERT INTO wp_term_relationships (object_id, term_taxonomy_id)
SELECT p.ID, @tag_id
FROM wp_posts p
WHERE p.post_type = 'product'
AND p.post_status = 'publish'
ORDER BY p.post_date DESC
LIMIT 5
ON DUPLICATE KEY UPDATE term_taxonomy_id = @tag_id;

-- 5. 更新标签计数
UPDATE wp_term_taxonomy 
SET count = (
    SELECT COUNT(*) 
    FROM wp_term_relationships 
    WHERE term_taxonomy_id = @tag_id
)
WHERE term_id = @tag_id;
```

## 🔍 验证设置

### 检查标签是否正确创建

1. **查看标签列表**
   ```
   WordPress 后台 → 产品 → 标签
   ```
   应该能看到"新品上线"标签，别名为 `new-arrival`

2. **检查产品标签**
   ```
   WordPress 后台 → 产品 → 编辑产品
   ```
   在右侧"产品标签"区域应该能看到"新品上线"

3. **查看首页效果**
   - 访问网站首页
   - "新品上线"区域应该显示带有该标签的产品
   - "更多产品"区域应该显示其他产品

## 🎨 产品卡片样式

所有产品卡片现在包含：
- 产品图片（带链接）
- 产品标题（带链接）
- 产品描述（自动截取前 10 个词）
- 产品价格
- "购买"按钮

### 标签样式
- **NEW**（绿色）：新品上线
- **HOT**（橙色）：热门推荐
- **SALE**（红色）：促销产品

## 📊 显示数量调整

如果需要调整显示的产品数量，编辑 `front-page.php`：

### 新品上线区域
```php
'posts_per_page' => 5,  // 修改这个数字
```

### 更多产品区域
```php
'posts_per_page' => 10,  // 修改这个数字
```

### 热门推荐区域
```php
'posts_per_page' => 5,  // 修改这个数字
```

## 🔧 自定义标签 Slug

如果您想使用不同的标签名称，需要修改两处：

### 1. 在 WordPress 后台创建标签时
使用您想要的 slug，例如：`xin-pin`

### 2. 修改 front-page.php
```php
// 新品上线区域（第 68 行附近）
'terms' => 'new-arrival',  // 改为您的 slug

// 更多产品区域（第 234 行附近）
'terms' => 'new-arrival',  // 改为您的 slug
```

## 🎯 常见问题

### Q1: 首页不显示产品？
**A**: 检查以下几点：
1. 产品是否已发布（不是草稿）
2. 产品是否设置了正确的标签
3. 标签的 slug 是否为 `new-arrival`
4. 清除所有缓存

### Q2: 产品图片不显示？
**A**: 
1. 确保产品已设置特色图片
2. 清除缓存（使用 clear-all-cache.php）
3. 检查图片文件是否存在

### Q3: "更多产品"显示了新品？
**A**: 
1. 检查产品是否同时有"新品上线"标签
2. 如果有，该产品只会在"新品上线"区域显示
3. 从产品中移除"新品上线"标签，它就会出现在"更多产品"区域

### Q4: 如何让某个产品同时出现在两个区域？
**A**: 
目前的逻辑是互斥的：
- 有"新品上线"标签 → 只在"新品上线"区域
- 没有"新品上线"标签 → 只在"更多产品"区域

如果需要同时显示，需要修改代码逻辑。

## 📝 测试清单

设置完成后，请检查：

- [ ] "新品上线"标签已创建，slug 为 `new-arrival`
- [ ] 至少有 1-5 个产品设置了"新品上线"标签
- [ ] 首页"新品上线"区域显示正确的产品
- [ ] 首页"更多产品"区域显示其他产品
- [ ] 产品图片正常显示
- [ ] 产品链接可以正常点击
- [ ] 价格显示正确
- [ ] 标签样式正确（NEW/HOT/SALE）

## 🧹 清除缓存

设置完成后，务必清除缓存：

1. **使用一键清除工具**
   ```
   访问：http://localhost/clear-all-cache.php
   ```

2. **手动清除**
   - WordPress 后台 → Performance → 清除所有缓存
   - 浏览器：Ctrl+Shift+Delete

---

**修改文件**：`wp-content/themes/xsrupb/front-page.php`  
**修改日期**：2026-02-28  
**版本**：1.0
